!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):window.jQuery&&!window.jQuery.fn.picker&&a(window.jQuery)}(function(a){"use strict";var b=["angle-double-down","angle-double-left","angle-double-right","angle-double-up","angle-down","angle-left","angle-right","angle-up"],c={placement:"bottomRight",title:!1,animation:!0,selected:!1,defaultValue:!1,onlyValid:!0,input:"input",hideOnPick:!1,displayButtons:!1,selectedCustomClass:"bg-primary",selectableItems:!1,inline:!1,component:".input-group-addon",container:!1,autoPlacement:!0,templates:{picker:'<div class="picker"><div class="picker-items"></div></div>',item:'<div class="picker-item"><i class="fa"></i></div>',buttons:'<div class="picker-buttons"><button class="picker-button picker-button-cancel btn btn-default btn-sm">Cancel</button><button class="picker-button picker-button-accept btn btn-primary btn-sm">Accept</button></div>',popover:'<div class="popover picker-popover"><div class="arrow"></div><div class="popover-title"></div><div class="popover-content"></div></div>'}},d=0,e=function(e,f){this._id=d++,this.element=a(e).addClass("picker-element"),this.options=a.extend(!0,{},c,this.element.data(),f),this.selectableItems=this.options.selectableItems,a.isArray(this.selectableItems)&&0!==this.selectableItems.length||(this.selectableItems=b),this.component=this.options.component,this.component=this.component!==!1?this.element.parent().find(this.component):!1,this.component!==!1&&0===this.component.length||!this.component?this.component=!1:this.component.addClass("picker-component"),this.container=this.options.container===!0?this.element:this.options.container,this.container=this.container!==!1?a(this.container):!1,this.container!==!1&&0===this.container.length||!this.container?this.container=!1:this.container.addClass("picker-container"),this.input=this.element.is("input")?this.element:this.options.input?this.element.find(this.options.input):!1,this.input!==!1&&0===this.input.length||!this.input?this.input=!1:this.input.addClass("picker-input"),this.originalPlacement=this.options.placement,this._createPicker(),this._createPopover(),this._bindEvents(),this._trigger("pickerCreate"),a(a.proxy(function(){this.update(this.options.selected)},this))};e.prototype={constructor:e,options:{},_id:0,_trigger:function(b,c){c=c||{},this.element.trigger(a.extend({type:b,picker:this},c))},_error:function(a){throw"Bootstrap Popover Picker Exception: "+a},_createPopover:function(){var b=this,c=this._hasCustomPlacement();return this.popover=this.element.popover({title:this.options.title,placement:c?"picker-placement":this.options.placement,container:this.element.parent(),animation:c?!1:this.options.animation,template:this.options.templates.popover,content:this.picker.element,html:!0,trigger:"manual"}).on("focus.picker",function(){a(this).popover("show")}).on("show.bs.popover.picker",function(){c&&b.popover.$tip?b.popover.$tip.css("opacity",0):b._trigger("pickerShow"),b.update()}).on("shown.bs.popover.picker",function(){c&&b.popover.$tip?b._showCustomPopover():b._trigger("pickerShown")}).data("bs.popover"),this.popover},_createPicker:function(b){b=b||{};var c=this,d=a(this.options.templates.picker);this.picker={element:d};var e=function(){var b=a(this);b.is(".fa")&&(b=b.parent()),c.update(b.data("pickerValue")),c._trigger("pickerSelect",{pickerItem:this,pickerValue:c.pickerValue}),c.options.displayButtons||c._trigger("pickerSelectAccepted",{pickerItem:c.picker.element.find(".picker-selected").get(0),pickerValue:c.pickerValue}),c.options.hideOnPick&&0===c.getAcceptButton().length&&c.hide()};for(var f in this.selectableItems){var g=a(this.options.templates.item);g.find(".fa").addClass("fa-"+this.selectableItems[f]),g.data("pickerValue",this.selectableItems[f]).on("click.picker",e),this.picker.element.find(".picker-items").append(g.attr("title","."+this.getValue(this.selectableItems[f])))}this.options.displayButtons&&(this.picker.element.append(a(this.options.templates.buttons)),this.getAcceptButton().on("click",function(){c.update(c.pickerValue,!0),c._trigger("pickerSelectAccepted",{pickerItem:c.picker.element.find(".picker-selected").get(0),pickerValue:c.pickerValue}),c.hide()}),this.getCancelButton().on("click",function(){c.hide()})),this.picker=a.extend(!0,this.picker,b)},_bindEvents:function(){if(this.options.inline===!1){var b=this,c=!1,d=!1,e=a.proxy(function(b){var c=a(b.target);return c.hasClass("picker-element")&&(!c.hasClass("picker-element")||c.is(this.element))||0!==c.parents(".picker-popover").length?!0:!1},this),f=a.proxy(function(a){return e(a)||this.hide(),a.stopPropagation(),a.preventDefault(),!1},this),g=a(window.document),h=".picker.inst"+this._id;g.on("mousedown"+h,function(){g.on("mousemove"+h,function(){d=!0,g.unbind("mousemove"+h)})}),g.on("mouseup"+h,function(a){c=d===!0,d=!1,g.unbind("mousemove"+h),c||f(a)}),g.on("click.picker"+h,function(a){d=!1,g.unbind("mousemove"+h),c||f(a)}),a(window).on("resize.picker"+h+" orientationchange.picker"+h,function(){b.setCustomPlacement()}),this.hasInput()&&(this.input.on("keyup.picker",function(c){b._updateFormGroupStatus(b.getValid(this.value)!==!1),-1===a.inArray(c.keyCode,[38,40,37,39,16,17,18,9,8,91,93,20,46,186,190,46,78,188,44,86])&&b.update(),b.hide()}),this.input.on("click.picker"))}},_unbindEvents:function(){this.element.off(".picker"),this.element.off(".picker"),this.hasInput()&&this.input.off(".picker"),this.hasComponent()&&this.component.off(".picker"),this.hasContainer()&&this.container.off(".picker"),a(window).off(".picker.inst"+this._id),a(window.document).off(".picker.inst"+this._id)},_hasCustomPlacement:function(){return-1===a.inArray(this.options.placement,["top","right","bottom","left","auto"])},_showCustomPopover:function(){this._trigger("pickerShow"),this.popover.$tip.removeClass("in"),this.setCustomPlacement(),this._trigger("pickerShown"),this.popover.$tip.addClass((this.options.animation?"fade ":"")+"in").css({opacity:""})},setCustomPlacement:function(b,c){b=b||this.options.placement,c=c===!1?!1:!0;var d,e,f,g,h,i=!1;switch(this.popover.$tip.removeClass("bottom top left right picker-placement-topLeft picker-placement-topRight picker-placement-rightTop picker-placement-rightBottom picker-placement-bottomRight picker-placement-bottomLeft picker-placement-leftBottom picker-placement-leftTop"),e=this.popover.$element.position(),f=this.popover.$element.offset(),this.popover.$tip.css("maxWidth",a(window).width()-f.left-5),d=this.popover.getPosition(/in/.test(b)),g=this.popover.$tip[0].offsetWidth,h=this.popover.$tip[0].offsetHeight,b){case"topLeft":i={top:-1*(h-d.height+e.top-5),right:"auto",bottom:"auto",left:e.left};break;case"topRight":i={top:-1*(h-d.height+e.top-5),right:-e.left,bottom:"auto",left:"auto"};break;case"rightTop":i={top:d.top-.25*h,right:"auto",bottom:"auto",left:d.width};break;case"rightBottom":i={top:d.height-.25*h,right:"auto",bottom:"auto",left:d.left};break;case"bottomRight":i={top:d.height+e.top,right:-e.left,bottom:"auto",left:"auto"};break;case"bottomLeft":i={top:d.height+e.top,right:"auto",bottom:"auto",left:e.left};break;case"leftBottom":i={top:d.height-.25*h,right:d.left,bottom:"auto",left:"auto"};break;case"leftTop":i={top:d.top-.25*h,right:"auto",bottom:"auto",left:d.left}}return i!==!1?(this.options.placement=b,this.popover.$tip.css(i).addClass("picker-placement-"+b),!0):(this.popover.$tip.addClass("picker-placement-"+this.options.placement),!1)},detectCollisions:function(b){var c={topLeft:"bottomLeft",topRight:"bottomRight",rightTop:"rightBottom",rightBottom:"rightTop",bottomRight:"topRight",bottomLeft:"topLeft",leftBottom:"leftTop",leftTop:"leftBottom"},d=(a(window).width(),a(window).height()),e=this.popover.$tip.offset(),f=(this.popover.$tip[0].offsetWidth,this.popover.$tip[0].offsetHeight);return console.log(e.top-f,0+d),e.top-f<0?(console.log("set esceed"),this.setCustomPlacement(c[b],!1)):null!=this.originalPlacement&&this.originalPlacement!=this.options.placement?(console.log("set prev"),this.setCustomPlacement(this.originalPlacement,!1)):void 0},_updateComponents:function(){if(this.picker.element.find(".picker-item.picker-selected").removeClass("picker-selected "+this.options.selectedCustomClass),this.picker.element.find(".fa.fa-"+this.pickerValue).parent().addClass("picker-selected "+this.options.selectedCustomClass),this.hasComponent()){var a=this.component.find("i");a.length>0?a.attr("class","fa fa-fw "+this.getValue()):this.component.html(this.getValueHtml())}},_updateFormGroupStatus:function(a){return this.hasInput()?(a!==!1?this.input.parent(".form-group").removeClass("has-error"):this.input.parent(".form-group").addClass("has-error"),!0):!1},_sanitizeValue:function(b){return("string"==typeof b||b instanceof String)==!1&&(b=""),a.trim(b.replace("fa-",""))},getValid:function(b){return b=this._sanitizeValue(b),-1===a.inArray(b,this.selectableItems)&&this.options.onlyValid?!1:b},setValue:function(a){var b=this.getValid(a);return b!==!1?(this.pickerValue=b,this._updateComponents(),this._updateFormGroupStatus(!0),this._trigger("pickerSetValue",{pickerValue:b}),this.pickerValue):(this._updateFormGroupStatus(!1),this._trigger("pickerInvalid",{pickerValue:a}),!1)},getValue:function(a){return"fa-"+(a?a:this.pickerValue)},getValueHtml:function(){return'<i class="fa '+this.getValue()+'"></i>'},setSourceValue:function(a){return a=this.setValue(a),a!==!1&&(this.hasInput()?this.input.val(this.getValue()):this.element.data("pickerValue",this.getValue()),this._trigger("pickerSetSourceValue",{pickerValue:a})),a},getSourceValue:function(a){a=a||this.options.defaultValue;var b=a;return b=this.hasInput()?this.input.val():this.element.data("pickerValue"),(void 0===b||""===b||null===b||b===!1)&&(b=a),b},hasInput:function(){return this.input!==!1},hasComponent:function(){return this.component!==!1},hasContainer:function(){return this.container!==!1},getAcceptButton:function(){return this.picker.element.find(".picker-button-accept")},getCancelButton:function(){return this.picker.element.find(".picker-button-cancel")},isDisabled:function(){return this.hasInput()?this.input.prop("disabled")===!0:!1},show:function(){a(a.proxy(function(){this.element.popover("show")},this))},hide:function(){this._trigger("pickerHide"),this.element.popover("hide")},update:function(a,b){return a=a?a:this.getSourceValue(this.pickerValue),this._trigger("pickerUpdate"),0===this.getAcceptButton().length||b===!0?this.setSourceValue(a):this.setValue(a),this._trigger("pickerUpdated"),a},destroy:function(){this.element.removeData("picker").removeData("pickerValue").removeClass("picker-element"),this.element.popover("destroy"),this._unbindEvents(),this._trigger("pickerDestroy")},disable:function(){return this.hasInput()?(this.input.prop("disabled",!0),!0):!1},enable:function(){return this.hasInput()?(this.input.prop("disabled",!1),!0):!1}},a.picker=e,a.fn.picker=function(b){var c=arguments,d=b;if(b===!0&&(c=Array.prototype.slice.call(c,1),d=c.length>0?c[0]:!1),b!==!0&&"string"!=typeof b)return this.each(function(){var c=a(this);c.data("picker")||"string"==typeof b||c.data("picker",new e(this,"object"==typeof b?b:{}))});if("string"==typeof d||b===!0){var c=Array.prototype.slice.call(c,1);if("string"!=typeof d||""===d)return b===!0?this:!1;if(b===!0)return this.each(function(){var b=a(this).data("picker");b&&b[d].apply(b,c)});var f=this.data("picker");if(f){var g=f[d];return g&&g.constructor&&g.call&&g.apply?g.apply(f,c):g}}}});